(()=>{var t;window.TL_Editor=window.TL_Editor||{},window.TCB_AnimViews=TVE.Views.Components.AnimationViews,window.TL_Editor.views=window.TL_Editor.views||{},TVE.leads=TVE.leads||{},window.TL_Editor.views.ModalTemplates=TVE.modal.base.extend({el:TVE.modal.get_element("tl-templates"),initialize:function(){TVE.modal.base.prototype.initialize.apply(this,arguments),this.$error=this.$(".error-container"),this.$template_items=this.$(".tl-set-list"),this.$saved_templates_checkbox=this.$(".saved-templates-checkbox"),this.$warning=this.$(".warning-ct-change"),this.$footer=this.$(".tcb-modal-footer"),this.templateWasSelected=!1},after_initialize:function(t){this.initClickHandler()},before_open:function(){this.$el.addClass("modal-w-sidebar"),this.$template_items.empty(),this.$warning.css("display","none"),this.$footer.css("display","none"),this.$(".tl-category-filter.active").removeClass("active"),this.$(".tl-category-filter[data-content='default']").addClass("active"),this.$(".tve-c-modal-search-input").val(""),this.$modalContent=this.$(".tcb-modal-content").css("height","100%"),this.templatesType="default",this.renderTemplates()},filterClick:function(t){this.templatesType=t.currentTarget.getAttribute("data-content"),this.renderTemplates(),this.$(".tl-category-filter.active").removeClass("active"),t.currentTarget.classList.toggle("active")},onSearch:function(){_.throttle(this.renderTemplates(),420)},clearSearch:function(){this.$(".tve-c-modal-search-input").val(""),this.renderTemplates()},renderTemplates:function(){var t=this;this.$template_items.empty(),this.$saved_templates_checkbox.css("display","none"),"saved"===this.templatesType&&this.$saved_templates_checkbox.css("display","flex"),this.getItems().then((function(e){t.setItems(t.filterTemplates(e)).then((function(){t.applyMasonry()}))}))},getItems:function(){var t=this;return new Promise((function(e){if("default"===t.templatesType)t.setTemplates(TVE.CONST.tl_templates),e(t.templates);else if("saved"===t.templatesType){var a={external_action:window.tve_leads_page_data.tpl_action,route:"get_saved",current_template:t.$("#tl-filter-current-templates").is(":checked")?1:0,post_id:TVE.CONST.post_id,_key:window.tve_leads_page_data._key};TVE.main.overlay(),TVE.ajax("save_post_external","post",a).fail((function(){TVE.utils.message("Error fetching templates!","error")})).done((function(a){if(!a.success&&!a.main_page_content)return TVE.page_message(a.message,!0),TVE.main.overlay("close");t.setTemplates(a.templates),TVE.main.overlay("close"),e(t.templates)}))}}))},filterTemplates:function(t){var e=this.$(".tve-c-modal-search-input").val().trim().toLowerCase();return t.filter((function(t){var a=!0;return a&&e&&!t.attributes.name.toLowerCase().includes(e)&&(a=!1),a}))},setItems:function(t){var e=[],a=this,i=TVE.tpl("templates/item");return TVE.CONST.tl_templates_error.error&&this.$error.fadeIn(200).html(TVE.tpl("inline-error")({error_message:TVE.CONST.tl_templates_error.error})),0===t.length?a.$template_items.append("No templates found"):t.forEach((function(t,n,o){var s="saved"===a.templatesType,r=t.get("thumb_sizes");if(s&&r&&isNaN(parseInt(r.h))){var l=new Promise((function(e){var n=new Image;n.src=t.get("thumbnail"),n.onload=function(){t.set({thumb_sizes:{w:n.width,h:n.height}}),a.$template_items.append(i({item:t,saved:s})),e()}}));e.push(l)}else a.$template_items.append(i({item:t,saved:s}))})),Promise.allSettled(e)},setTemplates:function(t){this.templates=new Backbone.Collection(t)},selectTemplate:function(t){var e=jQuery(t.currentTarget);this.$el.find(".cloud-item.active").removeClass("active"),this.$el.find(".modal-title-w-options.active").removeClass("active");var a=jQuery(".tcb-modal-tl-templates").height();this.$modalContent.css("height",a-82),e.addClass("active"),e.siblings().addClass("active"),(window.tve_leads_page_data.has_content||this.templateWasSelected)&&this.$warning.css("display","block"),this.$footer.css("display","block")},openOptionsTooltip:function(t){this.closeOptionsTooltip(),jQuery(t.target).closest(".modal-title-w-options").toggleClass("tooltip-open"),this.tooltipOpen=!0},closeOptionsTooltip:function(){this.tooltipOpen&&(this.$el.find(".tooltip-open").removeClass("tooltip-open"),this.tooltipOpen=!1)},initClickHandler:function(){var t=this;this.$el.on("mousedown",(function(e){var a=jQuery(e.target);t.tooltipOpen&&0===a.closest(".modal-title-w-options, .tcb-dropdown-dots").length&&t.closeOptionsTooltip()}))},applyMasonry:function(){var t=parseInt(this.$el.find(".cloud-template-item").outerWidth(!0));this.$el.find("img").each((function(){var e=jQuery(this)[0].getAttribute("data-ratio");e&&jQuery(this).parent().css("height",t*parseFloat(e))})),this.$template_items.data("masonry")&&this.$template_items.data("masonry").destroy();var e=this;setTimeout((function(){e.$template_items.masonry()}),0)},deleteConfirmation:function(t){var e=jQuery(t.currentTarget).closest(".cloud-template-item");e.find(".cb-template-wrapper").hide(),e.find(".symbol-delete-notice").css("display","flex"),this.closeOptionsTooltip()},hideDelete:function(t){var e=jQuery(t.currentTarget).closest(".cloud-item");e.find(".cb-template-wrapper").show(),e.find(".symbol-delete-notice").css("display","none")},deleteSavedTemplate:function(t){var e=jQuery(t.currentTarget).closest(".cloud-template-item"),a=this,i={external_action:window.tve_leads_page_data.tpl_action,route:"delete",tpl:e.attr("data-id"),post_id:TVE.CONST.post_id,_key:window.tve_leads_page_data._key};TVE.main.overlay(),TVE.ajax("save_post_external","post",i).done((function(t){e.remove(),a.applyMasonry(),TVE.main.overlay("close")}))},applyTemplate:function(){this.templateWasSelected=!0;var t=this,e=this.$(".cloud-item.active");if(e.length<=0)return TVE.page_message(TVE.t.SelectTemplate,!0,5e3);var a=e.data("id"),i=this.templates.findWhere({id:a});if(!(i instanceof Backbone.Model))return TVE.page_message("Something is wrong here. Template model not found ",!0);var n={tpl:i.get("key"),external_action:window.tve_leads_page_data.tpl_action,post_id:TVE.CONST.post_id,_key:window.tve_leads_page_data._key,route:"choose",cloud:i.get("cloud")||0,multi_step:i.get("multi_step")||0,form_type:i.get("form_type")||""};TVE.main.overlay(),jQuery("#tl-form-states").find(".design-states").is(":visible")&&jQuery("#tl-form-states").find("button.state-close").trigger("click"),TVE.ajax("save_post_external","post",n).done((function(e){if(!e.success&&!e.main_page_content)return TVE.page_message(e.message,!0),TVE.main.overlay("close");window.TL_Editor.state.insertResponse(e),TVE.Editor_Page.editor.find(TVE.identifier("lead_generation")).each((function(){TVE.regenerateFormIdentifier(TVE.inner_$(this))}));try{localStorage.setItem("tve_add_content_variation",JSON.stringify({form_type_id:n.post_id,variation_id:n._key}))}catch(t){}t.close()}))}}),window.TL_Editor.views.ModalTemplateSaving=TVE.modal.base.extend({el:TVE.modal.get_element("tl-template-saving"),after_initialize:function(){this.$el.addClass("medium")},save:function(){var t=this.$("input").val();if(t.length<=0)return TVE.page_message(TVE.t.tpl_name_required,!0,5e3);var e=this,a=t+TVE.CSS_Rule_Cache.generate_id(""),i={external_action:window.tve_leads_page_data.tpl_action,route:"save",post_id:TVE.CONST.post_id,_key:window.tve_leads_page_data._key,name:t,thumbnail:a};return TVE.main.overlay(),TVE.main.editor_settings.save(null,null,(function(){TVE.ajax("save_post_external","post",i).done((function(t){if(!t.success)return TVE.page_message(t.message,!0),TVE.main.overlay("close");window.TL_Editor.savePreview(a),TVE.main.overlay("close"),e.close(),TVE.page_message(t.message)}))})),this}}),TVE.leads.LightboxStateAction=window.TCB_AnimViews.ThriveLightbox.extend({reinit:function(){this.options.actions[this.key]?(this.$el.closest(".action-item").show(),this.list.set_items(this.options.actions[this.key].options)):this.$el.closest(".action-item").hide()},controls_init:function(){this.list=new TVE.Views.Controls.List({el:this.$(".state-list")[0],items:this.options.actions[this.key].options}),this.event_trigger="click",this.$animation=this.$("#lb-animation"),TVE.CONST.options.animation.actions.tl_state_lightbox?(this.$animation.show(),_.each(TVE.CONST.options.animation.actions.tl_state_lightbox.animations,(function(t,e){this.$animation.append('<option value="'+e+'">'+t+"</option>")}),this)):this.$animation.hide()},set_model:function(t){return this.model=void 0!==t?t:new Backbone.Model({config:{}}),this.list.set_value(parseInt(this.model.get("config").s||0)),this.$animation.val(this.model.get("config").anim||"instant"),this},validate:function(){return!!this.list.get_value()||TVE.page_message(TVE.t.state_missing,!0)},apply_settings:function(t){return!!this.validate()&&(this.model.set({a:this.key,t:this.event_trigger,config:{anim:this.$animation.val()||"instant",s:this.list.get_value()}}),!0)}}),TVE.leads.StateSwitchAction=TVE.leads.LightboxStateAction.extend({controls_init:function(){TVE.leads.LightboxStateAction.prototype.controls_init.apply(this,arguments),this.$animation.hide()}}),t=jQuery,TVE.add_filter("tve_form_submit_options",(function(t){return _.findWhere(t,{key:"state"})||t.push({key:"state",label:window.tve_leads_page_data.L.switch_state,icon:"state"}),t})),t((function(){new TVE.leads.StateManager({el:t("#tl-form-states")[0]}),TVE.add_filter("editor_loaded_callback",window.TL_Editor.tcb_editor_page_loaded),TVE.add_filter("before_editor_events",window.TL_Editor.before_editor_loaded),TVE.add_filter("tcb_insert_content_template",window.TL_Editor.pre_process_content_template),TVE.main.on("animation_update",(function(e,a){var i=a.read(e);t.each(i,(function(i,n){var o=n.a;if("thrive_leads_form_close"!==o){var s=parseInt(n.config.s),r=n.t,l=TVE.Components.animation.options.actions;if("click"===r){var d=l[o].options,_=[];d.length?(t.each(d,(function(t,e){e.id===s&&_.push(e.id)})),_.length||a.remove(e,r)):a.remove(e,r)}}}))}))})),TVE.leads.StateManager=TVE.Views.Base.base_view.extend({after_initialize:function(){this.dom={btn:this.$(".states-button-container")},window.TL_Editor.state.fixed_height()},expand:function(){clearTimeout(this.hide_timeout),this.$(".design-states").removeClass("hide-from-view")},collapse:function(t){this.hide_timeout=setTimeout(this.bind((function(){this.$(".design-states").addClass("hide-from-view")})),200)},cancel_hide:function(){clearTimeout(this.hide_timeout)},toggle_add:function(e){t(e.currentTarget).toggleClass("tl-multistep-open")},add:function(t){var e=t.currentTarget;e.getAttribute("data-subscribed")?alert(window.tve_leads_page_data.L.only_one_subscribed):(this.collapse(),TVE.main.overlay(),TVE.Editor_Page.save(!1,(function(){TVE.KEEP_OVERLAY=!0,window.TL_Editor.state.ajax({custom_action:"add",state:e.getAttribute("data-state")}).done((function(t){window.TL_Editor.state.insertResponse(t),TVE.Components.lead_generation.removeSettingsId(TVE.Editor_Page.editor)}))})))},select:function(t){var e=t.currentTarget.getAttribute("data-id"),a=TVE.$(".preview-content"),i=a.attr("href");this.collapse(),TVE.main.overlay(),TVE.Editor_Page.save(!1,(function(){TVE.KEEP_OVERLAY=!0,window.TL_Editor.state.ajax({custom_action:"display",id:e}).done(window.TL_Editor.state.insertResponse)})),a.attr("href",this.updateUrlParameter(i,"_key",e))},updateUrlParameter:function(t,e,a){var i=new RegExp("("+e+"=)[^&]+");return t.replace(i,"$1"+a)},visibility:function(e){var a=t(e.currentTarget);if(a.parents("li").hasClass("lightbox-step-active")&&void 0!==a.attr("data-visible"))return TVE.main.overlay(),this.collapse(),window.TL_Editor.state.ajax({custom_action:"visibility",visible:a.attr("data-visible")}).done((function(t){TVE.page_message(t.message),window.TL_Editor.state.insertResponse(t)})),!1},duplicate:function(t,e){if("already_subscribed"!==e.getAttribute("data-state"))return this.collapse(),TVE.main.overlay(),TVE.Editor_Page.save(!1,(function(){TVE.KEEP_OVERLAY=!0,window.TL_Editor.state.ajax({custom_action:"duplicate",id:e.getAttribute("data-id")}).done((function(t){window.TL_Editor.state.insertResponse(t),TVE.Components.lead_generation.removeSettingsId(TVE.Editor_Page.editor)}))})),!1;alert(window.tve_leads_page_data.L.only_one_subscribed)},remove:function(t,e){return!!confirm(window.tve_leads_page_data.L.confirm_state_delete)&&(this.collapse(),TVE.main.overlay(),window.TL_Editor.state.ajax({custom_action:"delete",id:e.getAttribute("data-id")}).done((function(t){TVE.page_message(window.tve_leads_page_data.L.state_deleted),window.TL_Editor.state.insertResponse(t)})),!1)}}),window.TL_Editor.state={fixed_height:function(){var e=t(".fix-height-states");"function"==typeof e.scrollbar?e.scrollbar():e.css("overflow-y","auto")},insertResponse:function(e){e||TVE.page_message("Something went wrong",!0),TVE.main&&TVE.main.$cpanel&&e.preview_link.length&&TVE.main.$cpanel.find(".preview-content").attr("href",decodeURIComponent(e.preview_link)),window.TL_Editor_Page.handle_state_response(e),t(".design-states").replaceWith(e.state_bar),window.TL_Editor.state.fixed_height(),e.tve_path_params.tl_templates&&modal_templates.setTemplates(TVE.CONST.tl_templates),e.animation_options&&(TVE.Components.animation.options=e.animation_options,TVE.Components.animation.reinit(),window.TL_Editor.FLAG_RE_RENDER_EVENTS=!0);var a=t(".total_states");e.tve_leads_page_data.states.length>=2?(a.show(),a.html(e.tve_leads_page_data.states.length-1)):a.hide(),setTimeout((function(){TVE.main.overlay("close")}),1)},ajax:function(t){return TVE.Editor_Page.blur(),t._key=window.tve_leads_page_data._key,t.post_id=window.tve_leads_page_data.post_id,t.active_state=window.tve_leads_page_data._key,t.external_action=window.tve_leads_page_data.state_action,TVE.ajax("save_post_external","post",t)}},window.TL_Editor.tcbEditorSetSelector=function(){if(!window.tve_leads_page_data.form_type.includes("lightbox")){var t=_.findWhere(window.tve_leads_page_data.states,{key:window.tve_leads_page_data._key});TVE.CONST.editor_selector="lightbox"===t.form_state?"body":""}},window.TL_Editor.savePreview=function(e){TVE.Editor_Page.blur(),TVE.Editor_Page.editor.find(".on_hover").removeClass("on_hover"),TVE.inner_$(".preview-cloned-content").remove();var a=TVE.inner_$(".thrv-leads-screen-filler, .thrv-leads-slide-in");0===a.length&&(a=TVE.Editor_Page.editor);var i=TVE.getContentToPreview(a);TVE.generateElementPreview(i,(function(a){var i=new FormData;a&&i.append("preview_file",a,e+".png"),i.append("route","save_thumbnail"),i.append("custom","save_thumbnail"),i.append("action",window.tve_leads_page_data.tpl_action),i.append("security",window.tve_leads_page_data.security),i.append("_key",window.tve_leads_page_data._key),i.append("post_id",window.tve_leads_page_data.post_id),i.append("file_name",e),t.ajax({type:"POST",url:window.tve_leads_page_data.ajaxurl,data:i,processData:!1,contentType:!1})}),{},!0)},window.TL_Editor.tcb_editor_page_loaded=function(){TVE.StorageManager.unset("tl_design-"+window.tve_leads_page_data.post_id),window.TL_Editor.tcbEditorSetSelector(),modal_templates=new window.TL_Editor.views.ModalTemplates,TVE.main.on("lgRenderOptionForm",(function(e,a,i){if("state"===i){var n=TVE.tpl("lead-generation/switch-states-form"),o=t(n()),s=o.find("select"),r="__TCB_EVENT_[",l="]_TNEVE_BCT__",d=function(e){var i="tl_state_switch",n=parseInt(e);a.set("_state",n),t(window.tve_leads_page_data.states).each((function(t,e){parseInt(n)===parseInt(e.key)&&"lightbox"===e.form_state&&(i="tl_state_lightbox")}));var o={t:"click",a:i,elementType:"a",config:{s:n}};o=r+JSON.stringify(o)+l,TVE.ActiveElement.find(".tve-switch-state-trigger").remove();var s=t('<a href="javascript:void(0)" style="display: none;" class="tve-switch-state-trigger tve_evt_manager_listen tve_et_click"></a>');s.attr("data-tcb-events",o),TVE.Components.lead_generation.getWrapper("form").append(s)};if(s.on("change",(function(t){d(t.currentTarget.value)})),t.each(window.tve_leads_page_data.states,(function(e,a){if(parseInt(a.key)!==parseInt(window.tve_leads_page_data._key)&&"already_subscribed"!==a.form_state){var i=t('<option value="'+a.key+'">'+a.state_name+"</option>");s.append(i)}})),TVE.ActiveElement.find(".tve-switch-state-trigger").length){var _=JSON.parse(TVE.ActiveElement.find(".tve-switch-state-trigger").attr("data-tcb-events").replace(r,"").replace(l,"")).config;s.val(_.s),TVE.ActiveElement.data("lg").set("_state",_.s)}else d(s.val());e.find("#lg-state").html(o).removeClass("tcb-hidden")}})),TVE.Components.lead_generation.on("tcb_lg_manage_submit_options",(function(t,e){e._write._form_type=function(){TVE.Components.lead_generation.getWrapper("form").append(TVE.Components.lead_generation.generateHiddenInput({name:"_form_type",value:window.tve_leads_page_data.form_type}))}})),t(TVE.main).on("tcb.open_templates_picker",(function(t){return t.preventDefault(),modal_templates.open({}),!1})),window.tve_leads_page_data.has_content||modal_templates.open({dismissible:!1}),TVE.main.sidebar_extra.tl_template_reset=function(){if(confirm(window.tve_leads_page_data.L.confirm_tpl_reset)){TVE.Editor_Page.blur(),TVE.main.sidebar_extra.hide_drawers();var t={_key:window.tve_leads_page_data._key,post_id:TVE.CONST.post_id,external_action:window.tve_leads_page_data.tpl_action,route:"reset"};TVE.main.overlay(),TVE.ajax("save_post_external","post",t).done(window.TL_Editor.state.insertResponse)}},TVE.main.sidebar_extra.tl_template_save=function(){if(this.modal instanceof Backbone.View)return this.modal.open();this.modal=new window.TL_Editor.views.ModalTemplateSaving,this.modal.open()},TVE.add_filter("link_search_lightbox",(function(){return""})),TVE.add_filter("tcb_save_post_data_before",(function(t){var e={m:"600px",t:"1023px",d:"1366px"};t["form-height"]={};var a=TVE.Editor_Page.editor.find(".tve_editor_main_content"),i=TVE.main.$frame.width();for(var n in 0===a.length&&(a=TVE.Editor_Page.editor),a.css("border","1px solid transparent"),e)TVE.main.$frame.width(e[n]),t["form-height"][n]=a.outerHeight(!0);if(a.css("border",""),TVE.main.$frame.width(i),TVE.inner_$(".tve_p_lb_content").length){var o,s=TVE.CONST.tve_globals;(o=TVE.inner_$(".tve_p_lb_content").attr("data-css"))&&(s.content_css=o)}return t})),TVE.add_action("tve.save_post.success",(function(){TVE.StorageManager.set("tl_design-"+window.tve_leads_page_data.post_id,!0)})),TVE.add_action("component.update.layout.tl-slide-in",(function(t){t.disable_extra_controls(["right","left"].map((function(t){return"margin-"+t})))}))},window.TL_Editor.before_editor_loaded=function(){var e=1,a=["thrive_leads_form_close","tl_state_lightbox","tl_state_switch"];TVE.add_filter("tcb_froala_config",(function(){return{linkEventActions:{getHtml:function(){var t=TVE.Components.animation.options.actions,a={thrive_leads_form_close:t.thrive_leads_form_close};return t.tl_state_switch&&t.tl_state_switch.options.length&&(a.tl_state_switch=t.tl_state_switch),t.tl_state_lightbox&&t.tl_state_lightbox.options.length&&(a.tl_state_lightbox=t.tl_state_lightbox),TVE.tpl("froala-leads-states")({actions:a,current_id:++e})},bindEvents:function(t){t.on("change",".fr-extra-action",(function(e){t.find(".tl-action-config").hide(),this.checked?(t.find(".tl-action-opts-"+this.getAttribute("data-key")).show(),t.find(".fr-link-atts,.fr-link-url").hide(),t.find(".fr-extra-action").not(this).prop("checked",!1)):t.find(".fr-link-atts,.fr-link-url").show()}))},hasSelected:function(t){return t.find(".fr-extra-action:checked").length},getEventConfig:function(t){var e={};return e.a=t.find(".fr-extra-action:checked").attr("data-key"),e.t="click",e.config={s:t.find(".tl-action-opts-"+e.a+' select[name="s"]').val(),anim:t.find(".tl-action-opts-"+e.a+' select[name="a"]').val()},e},reset:function(t){window.TL_Editor.FLAG_RE_RENDER_EVENTS&&(t.find(".tl-link-actions").replaceWith(this.getHtml()),delete window.TL_Editor.FLAG_RE_RENDER_EVENTS),t.find(".fr-extra-action").prop("checked",!1),t.find(".fr-link-atts,.fr-link-url").show(),t.find(".tl-action-config").hide()},updateFromLink:function(e,i){var n=!1;if(this.reset(i),e.hasClass("tve_evt_manager_listen")){var o=TVE.EventManager.get(e,"click");o&&-1!==t.inArray(o.a,a)&&(i.find('.fr-extra-action[data-key="'+o.a+'"]').prop("checked",!0).trigger("change"),i.find(".tl-action-opts-"+o.a+' select[name="s"]').val(o.config.s),n=!0,i.find(".tl-action-opts-"+o.a+' select[name="a"]').val(o.config.anim||"instant"))}return n}}}}));var i=TVE.CustomHTML;TVE.CustomHTML=TVE.CustomHTML.extend({append_extra_settings:function(){this.$(".extra-settings").remove()},after_initialize:function(){i.prototype.after_initialize.apply(this,arguments),this.$(".tcb-modal-title").after(TVE.tpl("custom-html-options")()),this.$lazy_load=this.$("#custom-html-lazy-load")},before_open:function(){i.prototype.before_open.apply(this,arguments),this.$("#tl-custom-html-opts").toggle(!window.tve_leads_page_data.is_default_state)},is_lazy_load:function(){return!window.tve_leads_page_data.is_default_state&&"lazy"===this.$lazy_load.val()},prepare_content_for_save:function(t){return this.is_lazy_load()&&(t='<script type="text/template" style="display: none" class="tcb-lazyload-template">'+t+"<\/script>"),t},prepare_content_for_load:function(){var t,e=TVE.ActiveElement.children().first();return 1===e.length&&e.is('script.tcb-lazyload-template[type="text/template"]')?(this.$lazy_load.val("lazy"),t=e.html()):t=TVE.ActiveElement.html(),t}})}})();