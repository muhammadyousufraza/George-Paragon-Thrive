(()=>{var t;(t=jQuery).fn.testimonial_capture_form=function(){return this.each((function(){var e,a=t(this),r=a.find(".on_success").val();a.wrapInner('<form method="post"></form>'),a.find(".tvo-form-picture").hover((function(){var e=t(this);e.attr("src")==e.attr("data-default")&&e.find(".tvo-social-picture").show()}),(function(){t(this).find(".tvo-social-picture").hide()})),a.find(".tvo_email").blur((function(){var e=this.value,r=a.find(".tvo-picture-wrapper");r.length>0&&n(e)&&t.ajax({type:"GET",url:TVO_Form.gravatar_route,data:{email:e}}).done((function(t){t&&(r.css("background-image","url("+t+")"),a.find(".tvo-remove-image").show())}))})),a.find(".tvo-remove-image").click((function(){var e=a.find(".tvo-picture-wrapper");e.css("background-image","url("+e.attr("data-default")+")"),t(this).hide()}));var o=function(t){a.find(".tvo-form-error").html(t)},n=function(){var t=a.find(".tvo_email");return""===t.val()||/\S+@\S+\.\S+/.test(t.val())};(e=a.find(".tvo-form-button")).on("click",(function(i){i.stopPropagation(),i.preventDefault();var f,d,s,u=e.text();if(e.text(TVO_Form.translate.sending),o(""),f=!1,a.find(".tvo_input").each((function(){var e=t(this);e.hasClass("tvo_required")&&0===e.val().length?(e.addClass("tvo_required_error"),f=!0):e.removeClass("tvo_required_error")})),f)return e.text(u),o(TVO_Form.translate.required),!1;if(!n())return e.text(u),o(TVO_Form.translate.validEmail),!1;if(d=a.find(".tvo_website_url").val(),s=new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$"),void 0!==d&&""!=d&&!s.test(d.toLowerCase()))return e.text(u),o(TVO_Form.translate.validURL),!1;var c=function(){var e={},r=a.find(".tvo-picture-wrapper");return a.find(".tvo_input").each((function(){var a=t(this),r=a.attr("name"),o=a.val();void 0!==r&&(e[r]=o)})),e.content="",a.find(".tvo-form-textarea").each((function(){e.content+=this.value+"\n\r\n\r"})),a.find(".g-recaptcha").length?(e._use_captcha=1,e["g-recaptcha-response"]=a.find(".g-recaptcha-response").val()):e._use_captcha=0,r.length>0?(e.picture_url=r.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,""),r.attr("data-default")==e.picture_url&&(e.picture_url="")):e.picture_url="",e}(),l=a.find(".tvo_form_state"),v=a.find(".tvo_success_state"),_=function(){var t=a.find(".tvo-form-config"),e={};return e.tags=JSON.parse(t.find(".tags").val()),e.shortcode_id=t.find(".shortcode_id").val(),e.post_id=TVO_Form.post_id,e}();t.extend(c,_),e.attr("disabled",!0),t.ajax({headers:{"X-WP-Nonce":TVO_Form.nonce},type:"POST",url:TVO_Form.testimonial_route,data:c}).fail((function(t){e.text(u),e.attr("disabled",!1),t.responseJSON&&o(t.responseJSON.message)})).done((function(){switch(e.attr("disabled",!1),r){case"message":l.hide(),v.show();break;case"redirect":window.location=a.find(".on_redirect").val();break;default:location.reload()}}))}))}))},t((function(){t(document).on("tve_shortcode_content_loaded",(function(t,e){var a=e.$(".tvo_testimonial_form");a.length&&a.testimonial_capture_form()})),t(".tvo_testimonial_form").testimonial_capture_form()}))})();