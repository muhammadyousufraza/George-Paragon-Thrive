(()=>{var t;TVO_Shortcode=function(t){var e={id:TVO_Front.shortcode_id,template:"",$element:t,config:{},menu:{},templates_modal:jQuery("#tvo-testimonial-templates"),save_notification_timeout:null,route:function(t){return void 0===t&&(t=""),TVO_Front.routes.shortcodes+t+"/"+e.id},_bind:function(t){e.menu=t;var o=e.templates_modal.find(".tvo-save-template");t.find(".tvo_menu_item").each((function(){var t=jQuery(this);t.on("click",e[t.data("func")])})),t.find(".tvo_config_field").on("click",(function(){e.config=e.getFormData(t,e.config),e.save()})),jQuery(document).on("click",".tvo-template ",e.template_select),jQuery(document).on("tvo_event",(function(t,o,n){"function"==typeof e[o]?e[o](n):e[o]=n})),e.simple_bind(o,jQuery.proxy(e.save_template,e)),e.load(e.init)},displayMessage:function(t,e,o){var n=jQuery("#tvo_notification_box").show(0);n.length||(n=jQuery('<div id="tvo_notification_box"></div>').appendTo("body")),-1===e?n.addClass("tvo_warning_box"):e?n.addClass("tvo_error_box"):n.removeClass("tvo_error_box tve_warning_box"),void 0===o&&(o=2e3),-1===e?n.html(t):n.text(t),n.animate({left:100},700),setTimeout((function(){n.animate({left:-950},700)}),o)},displayWarning:function(){var t=this;this.save_notification_timeout=setInterval((function(){t.displayMessage('<div class="tvo-f-icon-close"></div><p><strong>Reminder</strong></p><br/><p>You have not saved your work for 10 minutes.</p><p>We recommend you perform a save to make sure you don\'t lose any work !</p></br><a id="tvo-stop-saving-warning" style="display: block; text-align: right" href="javascript:void(0)">Stop reminding me for this work only !</a>',-1,6e3),jQuery("#tvo-stop-saving-warning").click((function(){jQuery("#tvo_notification_box").fadeOut(200),t.cancelWarning()})),jQuery("#tvo_notification_box .tvo-f-icon-close").click((function(){jQuery(this).parent().fadeOut(200)}))}),6e5)},cancelWarning:function(){clearInterval(this.save_notification_timeout),this.save_notification_timeout=null},save_config:function(t){e.config=jQuery.extend({},e.config,t)},save_template:function(){e.template=e.templates_modal.find(".tvo-template.current").data("value"),e.save(),window.setTimeout((function(){window.opener.postMessage({event:"tvo_testimonials_template_update",template:e.template},"*")}),1e3)},simple_bind:function(t,o,n){void 0===n&&(n="click"),t instanceof jQuery||(t=e.$element.find(t)),t.on(n,jQuery.proxy(o,e))},setConfig:function(t,o){e.config[t]=o},getFormData:function(t,e){var o={};return void 0!==e&&(o=e),t.find(".tvo_config_field").each((function(){o[this.name]="checkbox"===this.type?this.checked?1:0:this.value})),o},setFormData:function(t,o){void 0===o&&(o=e.config),t.find(".tvo_config_field").each((function(){"checkbox"===this.type?this.checked=1===parseInt(o[this.name]):this.value=o[this.name]||""}))},save:function(t){0!==e.template.length&&(window.onbeforeunload=null,e.config=e.getFormData(e.menu,e.config),e.setConfig("template",e.template),TVO_Front.preloader.show(),jQuery.ajax({headers:{"X-WP-Nonce":TVO_Front.nonce},cache:!1,data:{config:e.config},method:"POST",url:e.route()}).done((function(o){e.load(),e.displayMessage("All changes saved!"),"function"==typeof t&&t(),void 0!==e.activeModal&&e.activeModal.closeModal()})).fail((function(t){console.error(t)})))},load:function(t){e.setConfig("template",e.template),TVO_Front.preloader.show(),jQuery.ajax({headers:{"X-WP-Nonce":TVO_Front.nonce},cache:!1,method:"GET",url:e.route("/frontend")}).done((function(o){e.config=o.config,e.template=o.config.template,e.$element.css("opacity","0.05"),e.$element.html(o.template),setTimeout((function(){e.$element.css("opacity","1"),TVO_Front.preloader.hide()}),700),TVO_Front.active_config=o.config,"function"==typeof t&&t()})),e.cancelWarning(),e.displayWarning()},template_select:function(){this.parentNode.childNodes.forEach((function(t){t.nodeType!==Node.TEXT_NODE&&t.classList.remove("current")})),this.classList.add("current")},toggle_fields:function(){var t=jQuery(this).data("toggle");jQuery(t).toggle()},openModal:function(t){e.activeModal=e[t],e.activeModal.openModal()},closeModal:function(t){!t.length&&this.activeModal&&(t="activeModal"),e[t].closeModal()},init:function(){},preselectTemplate:function(t){t.find(".tvo-template").each((function(){this.dataset.value===e.template?this.classList.add("current"):this.classList.remove("current")}))}};return e},jQuery.fn.extend({tvo_capture_form:function(){var t=TVO_Shortcode(jQuery(this));t.settings_modal=jQuery("#tvo-form-settings"),t.form_settings=function(){t.openModal("settings_modal"),t.setFormData(t.settings_modal),t.settings_modal.find(".tvo-all-tags").val(t.config.tags).trigger("change"),t.settings_modal.find(".tvo-question").remove(),t.config.questions.forEach((function(e,o){jQuery("<div>",{class:"tvo-row tvo-collapse tvo-question"+(0===o?" tvo-default-question":""),html:TVO_Front.tpl("new-question")({index:o,question:e,config:t.config})}).insertBefore(".tvo-add-question")}))},t.change_template=function(){t.openModal("templates_modal"),t.preselectTemplate(t.templates_modal)};var e=t.settings_modal.find(".tve_editor_button ");return t.simple_bind(e,(function(){t.config=t.getFormData(t.settings_modal,t.config),t.config.questions=[],t.config.placeholders=[],t.config.questions_required=[],t.settings_modal.find(".tvo-question").each((function(e){var o=jQuery(this);t.config.questions[e]=o.find(".tvo-question-input").val(),t.config.placeholders[e]=o.find(".tvo-placeholder-input").val(),t.config.questions_required[e]=o.find(".tvo-required").is(":checked")?1:0})),t.config.tags=t.settings_modal.find(".tvo-all-tags").val(),t.save()}),"click"),t.init=function(){t.template=t.config.template,t.simple_bind(t.menu.find(".tvo_template_colors li"),(function(e){var o=jQuery(e.currentTarget).attr("class"),n=t.$element.find(".tvo_testimonial_form");window.onbeforeunload=function(){return!0},t.setConfig("color_class",o),n.attr("class",n.attr("class").replace(/tve_(\w+)/i,o))})),jQuery(document).mouseup((function(e){var o=t.menu.find(".tvo_toggle_fields_box");o.is(e.target)||0!==o.has(e.target).length||o.hide()})),t.template.length||t.openModal("templates_modal")},t},tvo_display_testimonials:function(){var t=TVO_Shortcode(jQuery(this)),e=function(){Backbone.history.stop(),Backbone.history.start(),void 0===TVO_Front.active_config||0===TVO_Front.active_config.testimonials.length&&0===TVO_Front.active_config.tags.length?TVO_Front.router.navigate("#start",{trigger:!0}):TVO_Front.router.navigate("#pre-select",{trigger:!0}),TVO_Front.active_element=jQuery("#tvo_display_shortcode")};return t.settings_modal=jQuery("#tvo-display-testimonials"),t.display_settings=function(){t.openModal("settings_modal"),e()},t.change_template=function(){t.template_select="update",t.openModal("templates_modal"),t.preselectTemplate(t.templates_modal)},t.init=function(){t.menu.find(".tvo_toggle_fields_box").find("input").each((function(){var e=jQuery(this),o="0"!=t.config[e.attr("name")];e.prop("checked",o)})),jQuery(document).mouseup((function(e){var o=t.menu.find(".tvo_toggle_fields_box");o.is(e.target)||0!==o.has(e.target).length||o.hide()})),t.menu.find("#show_role").is(":checked")||t.menu.find("#show_site").prop("disabled",!0),t.menu.find("#show_role").click((function(){var e=t.menu.find("#show_site");jQuery(this).is(":checked")?e.prop("disabled",!1):e.prop("disabled",!0)})),t.simple_bind(t.menu.find(".tvo_template_colors li"),(function(e){var o=jQuery(e.currentTarget).attr("class"),n=t.$element.find(".tvo-testimonials-display");window.onbeforeunload=function(){return!0},t.setConfig("color_class",o),n.attr("class",n.attr("class").replace(/tve_(\w+)/i,o))})),0===t.config.tags.length&&0===t.config.testimonials.length&&(t.template_select="init",t.openModal("templates_modal"),t.activeModal.find(".tvo_select_template").val("Continue"))},t.save_template=function(){t.template=t.templates_modal.find(".tvo-template.current").data("value"),"init"===t.template_select?(t.activeModal.closeModal(),t.openModal("settings_modal"),e()):t.save()},t}}),window.TVO_Front=window.TVO_Front||{},TVO_Front.preloader={spinner:jQuery("#tvd-hide-onload"),show:function(){this.spinner.show()},hide:function(){var t=this.spinner;setTimeout((function(){t.fadeOut(100)}),200)}},(t=jQuery)((function(){window.onbeforeunload=null;var e=t("#tvo-preview-menu"),o=t("#tvo_capture_shortcode"),n=t("#tvo_display_shortcode");if(o.length>0)o.tvo_capture_form()._bind(e);else if(n.length>0){var i=n.tvo_display_testimonials();i._bind(e)}!function(e){var o=t("#wpadminbar"),n=t("#mm-preview-settings-bar:visible"),i=t("body"),a=0,s=0;o.length&&(a+=o.outerHeight(),s+=parseInt(e.outerHeight())),n.length&&(a+=n.outerHeight(),s+=parseInt(n.outerHeight())),e.css("top",a),i.css("margin-top",parseInt(i.css("margin-top"))+parseInt(s))}(e),t(document).on("tvo.get.shortcode",(function(t,e){i.save_config(e),i.save()})),t(document).on("tvo.save.shortcode",(function(e,o){i.save_config(o);var n={name:i.config.name,type:"display",config:i.config,content:""};t.ajax({headers:{"X-WP-Nonce":TVO_Front.nonce},cache:!1,url:TVO_Front.routes.shortcodes,type:"POST",data:n}).done(i.save)}))})),t("body").on("click",".tve_scT > ul li",(function(e){var o=t(this),n=o.parents(".tve_scT").first(),i=n.find(".tve_scTC").eq(o.index());n.find(".tve_tS").removeClass("tve_tS"),o.addClass("tve_tS"),n.find(".tve_scTC").hide(),i.show(),e.preventDefault()}))})();